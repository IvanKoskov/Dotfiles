"use strict";var m=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var x=(i,t)=>{for(var o in t)m(i,o,{get:t[o],enumerable:!0})},S=(i,t,o,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of v(t))!w.call(i,r)&&r!==o&&m(i,r,{get:()=>t[r],enumerable:!(e=f(t,r))||e.enumerable});return i};var b=i=>S(m({},"__esModule",{value:!0}),i);var X={};x(X,{default:()=>P});module.exports=b(X);var l=require("child_process"),p=require("util"),n=(0,p.promisify)(l.exec);function h(i,t){let o=new Map;for(let e of i){let r=t(e),s=o.get(r);s?s.push(e):o.set(r,[e])}return Array.from(o.keys()).map(e=>({key:e,values:o.get(e)??[]}))}var y=require("@raycast/api"),c=class i{static get bundleIdentifier(){return"com.apple.dt.Xcode"}static get downloadUrl(){return"https://apps.apple.com/app/id497799835"}static get developerDocumentationURLScheme(){return"x-xcode-documentation://"}static async isXcodeInstalled(){return!!(await(0,y.getApplications)()).find(o=>o.bundleId===i.bundleIdentifier)}static async isXcodeRunning(){try{return(await n("pgrep Xcode")).stdout.trim().length!==0}catch{return!1}}static launchXcode(){return n([`open -j -b ${i.bundleIdentifier}`,"sleep 2"].join(" && ")).then()}};var a=class extends Error{constructor(o){super(o);this.reason=o}};var u=class i{static launchSimulatorApplication(){return n('open -b "com.apple.iphonesimulator"').then()}static async xcodeSimulatorGroups(t){let o=await i.xcodeSimulators();return h(o.filter(e=>t==="All"||e.state===t),e=>e.runtime).map(e=>({runtime:e.key,simulators:e.values})).sort((e,r)=>e.runtime.localeCompare(r.runtime))}static async xcodeSimulators(){let t=await n("xcrun simctl list -j -v devices"),o=JSON.parse(t.stdout);if(!o||!o.devices)throw[];let e=[];for(let r in o.devices){let s=r.substring(r.lastIndexOf(".")+1).split("-"),g=[s.shift(),s.join(".")].join(" ");e.push(...o.devices[r].map(d=>(d.runtime=g,d)))}return e}static boot(t){return n(`xcrun simctl boot ${t}`).then(()=>{i.launchSimulatorApplication()})}static shutdown(t){return n(`xcrun simctl shutdown ${t}`).then()}static toggle(t){switch(t.state){case"Booted":return i.shutdown(t.udid);case"Shutting Down":return Promise.resolve();case"Shutdown":return i.boot(t.udid)}}static async restart(t){await i.shutdown(t),await i.boot(t)}static async app(t,o,e){try{await i.boot(e.udid)}catch{}return n(["xcrun","simctl",t,e.udid,o].join(" ")).then()}static async appPrivacy(t,o,e,r){try{await i.boot(r.udid)}catch{}return n(["xcrun","simctl","privacy",r.udid,t,o,e].join(" ")).then()}static isValidUrl(t){return/\w+:\/\/+/.test(t)}static async openUrl(t,o){let e=t.trim();if(!i.isValidUrl(e))throw new a("Bad Url");if(!o){if(!await c.isXcodeInstalled())throw new a("Xcode is not installed");if(!(await i.xcodeSimulators()).some(s=>s.state==="Booted"))throw new a("No simulator booted")}return n(["xcrun","simctl","openurl",o??"booted",`"${e}"`].join(" ")).then(()=>{i.launchSimulatorApplication()})}static async sendPushNotification(t,o,e){return n(`xcrun simctl push ${t.udid} ${o} ${e}`).then()}static async deleteAppFiles(t,o){let e=o?n(`rm -rf ${o}`):Promise.resolve();return Promise.all([n(`rm -rf ${t}`),e]).then()}static async rename(t,o){return n(`xcrun simctl rename ${t.udid} '${o}' `).then()}static async delete(t){return n(`xcrun simctl delete ${t.udid}`).then()}static async triggerIcloudSync(t){return n(`xcrun simctl icloud_sync ${t.udid}`).then()}};var P=i=>u.restart(i.xcodeSimulatorUDID);
